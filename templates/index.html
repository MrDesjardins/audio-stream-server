<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Radio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css?v=1737842303">
</head>

<body>
    <div class="container">
        <header>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                <i class="fas fa-moon" id="theme-icon"></i>
            </button>
            <h1><i class="fab fa-youtube"></i> Private YouTube Radio</h1>
        </header>

        <main>
            <div class="control-section">
                <div class="input-group">
                    <label for="youtube_video_id">
                        <i class="fas fa-link"></i> Add to Queue - YouTube Video ID or URL
                    </label>
                    <input type="text" id="youtube_video_id" placeholder="Enter YouTube ID or URL" value="">
                </div>

                {% if transcription_enabled %}
                <div class="checkbox-group">
                    <label for="skip_transcription" class="checkbox-label">
                        <input type="checkbox" id="skip_transcription" name="skip_transcription">
                        <span>
                            <i class="fas fa-music"></i>
                            Skip transcription (for music)
                        </span>
                    </label>
                </div>
                {% endif %}

                <div class="button-group">
                    <button onclick="addToQueue()" class="btn btn-primary">
                        <i class="fas fa-plus-circle"></i>
                        Add to Queue
                    </button>
                    <button onclick="clearQueue()" class="btn btn-secondary">
                        <i class="fas fa-trash-alt"></i>
                        Clear Queue
                    </button>
                </div>
            </div>

            <div class="queue-section">
                <div class="queue-header">
                    <h2>
                        <i class="fas fa-list"></i>
                        Queue
                    </h2>
                    <span id="queue-count" class="queue-count">0 tracks</span>
                </div>
                <div id="queue-list" class="queue-list">
                    <p class="queue-empty">Queue is empty. Add videos above to start!</p>
                </div>
                <div class="queue-controls">
                    <button onclick="playQueue()" class="btn btn-play-queue">
                        <i class="fas fa-play"></i>
                        <span>Play Queue</span>
                    </button>
                    {% if book_suggestions_enabled %}
                    <button onclick="suggestVideos()" class="btn btn-suggest" id="suggest-btn">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                        <span>Smart Suggestions</span>
                    </button>
                    {% endif %}
                </div>
            </div>

            <div class="player-section">
                <div class="status-indicator">
                    <span id="status-dot" class="status-dot"></span>
                    <i class="fas fa-broadcast-tower"></i>
                    <p id="status">Status: idle</p>
                </div>

                <!-- Audio player - source is set dynamically via JavaScript -->
                <!-- If playback fails, check your .env file FASTAPI_HOST setting -->
                <audio id="player" controls playsinline preload="none">
                    Your browser does not support audio.
                </audio>
                <div id="stream-status" class="stream-status hidden">
                    <i class="fas fa-sync fa-spin"></i>
                    <span id="stream-status-text">Reconnecting...</span>
                </div>

                <div class="playback-controls">
                    <button onclick="rewind()" class="btn btn-control">
                        <i class="fas fa-backward"></i>
                        <span class="btn-label">-15s</span>
                    </button>
                    <button onclick="pauseAudio()" class="btn btn-control">
                        <i class="fas fa-pause"></i>
                        <span class="btn-label">Pause</span>
                    </button>
                    <button onclick="playAudio()" class="btn btn-control">
                        <i class="fas fa-play"></i>
                        <span class="btn-label">Play</span>
                    </button>
                    <button onclick="fastforward()" class="btn btn-control">
                        <i class="fas fa-forward"></i>
                        <span class="btn-label">+15s</span>
                    </button>
                    <button onclick="playNext()" class="btn btn-control btn-next">
                        <i class="fas fa-step-forward"></i>
                        <span class="btn-label">Next</span>
                    </button>
                    <button onclick="stopStream()" class="btn btn-control btn-stop">
                        <i class="fas fa-stop"></i>
                        <span class="btn-label">Stop</span>
                    </button>
                </div>

                <div class="speed-controls">
                    <span class="speed-label">Speed:</span>
                    <button onclick="setSpeed(1.0)" class="btn btn-speed active" id="speed-1x">
                        <span class="btn-label">1x</span>
                    </button>
                    <button onclick="setSpeed(1.15)" class="btn btn-speed" id="speed-1.15x">
                        <span class="btn-label">1.15x</span>
                    </button>
                    <button onclick="setSpeed(1.3)" class="btn btn-speed" id="speed-1.3x">
                        <span class="btn-label">1.3x</span>
                    </button>
                    <button onclick="setSpeed(1.5)" class="btn btn-speed" id="speed-1.5x">
                        <span class="btn-label">1.5x</span>
                    </button>
                </div>
            </div>

            {% if transcription_enabled %}
            <div class="transcription-section">
                <div class="transcription-header">
                    <h2>
                        <i class="fas fa-file-alt"></i>
                        Transcription
                    </h2>
                </div>
                <div id="transcription-status" class="transcription-status">
                    <p class="transcription-idle">Start streaming to see transcription status</p>
                </div>
            </div>

            <!-- Summary Modal -->
            <div id="summary-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-file-alt"></i> Summary</h2>
                        <button onclick="closeSummaryModal()" class="modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="summary-content" class="modal-body">
                        <p>Loading summary...</p>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if weekly_summary_enabled %}
            <div class="weekly-summaries-section">
                <div class="summaries-header">
                    <h2>
                        <i class="fas fa-calendar-week"></i>
                        Weekly Summaries
                    </h2>
                </div>
                <div id="summaries-list" class="summaries-list">
                    <p class="summaries-empty">No summaries yet</p>
                </div>
            </div>
            {% endif %}

            <div class="history-section">
                <div class="history-header">
                    <h2>
                        <i class="fas fa-history"></i>
                        Recent Videos
                    </h2>
                </div>
                <div id="history-list" class="history-list">
                    <p class="history-empty">No history yet</p>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <button onclick="window.location.href='/admin/stats'" class="btn btn-stats">
                <i class="fas fa-chart-line"></i>
                <span>LLM Usage Statistics</span>
            </button>
        </footer>
    </div>

    <!-- Application Configuration - Injected from Server -->
    <script>
        window.appConfig = {
            apiBaseUrl: 'http://{{ host }}:{{ api_port }}',
            transcriptionEnabled: {{ 'true' if transcription_enabled else 'false' }},
            weeklySummaryEnabled: {{ 'true' if weekly_summary_enabled else 'false' }},
            bookSuggestionsEnabled: {{ 'true' if book_suggestions_enabled else 'false' }},
            prefetchThresholdSeconds: {{ prefetch_threshold_seconds }},
            clientLogBatchInterval: {{ client_log_batch_interval }},
            triliumUrl: '{{ trilium_url }}'
        };
    </script>

    <!-- Main Application Script -->
    <script src="/static/app.js"></script>
</body>

</html>
